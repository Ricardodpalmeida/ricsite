---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

// Get current language and translations
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section class="side-projects-section">
  <div class="section-container">
    <h2 class="section-title">Side Projects</h2>
    
    <!-- Podcast Section -->
    <div class="project-container">
      <h3 class="subsection-title">Podcast</h3>
      <p class="section-description">
        'Mesa do Canto' was a podcast in Portuguese where a friend and I convened to discuss a variety of subjects, 
        including culture, politics, philosophy, history, economics, and technology.
      </p>
      <div class="podcast-embed">
        <iframe 
          style="border-radius:12px" 
          src="https://open.spotify.com/embed/show/4lj3PvhecSWd5wUJAF3Lk6?utm_source=generator&theme=0" 
          width="100%" 
          height="352" 
          frameBorder="0" 
          allowfullscreen="" 
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
          loading="lazy"
        ></iframe>
      </div>
    </div>
    
    <!-- DJ Sets Section -->
    <div class="project-container">
      <h3 class="subsection-title">Latest Sets</h3>
      <p class="section-description">
        I'm a DJ specializing in Jazz, African Funk and Jazz, Deep, Future, Disco and Progressive House, 
        along with other world music like Habibi Funk. All my sets are improvised, mixing both vinyl and digital formats.
      </p>
      <div class="sets-carousel">
        <button class="carousel-arrow prev" aria-label="Previous set">←</button>
        <div class="carousel-container">
          <div class="carousel-track">
            <div class="carousel-item">
              <iframe width="100%" height="120" src="https://player-widget.mixcloud.com/widget/iframe/?hide_cover=1&feed=%2Fricardo-almeida28%2F" frameborder="0" title="DJ Set 1"></iframe>
            </div>
            <div class="carousel-item">
              <iframe width="100%" height="120" src="https://player-widget.mixcloud.com/widget/iframe/?hide_cover=1&feed=%2Fricardo-almeida28%2Fnadar%2F" frameborder="0" title="DJ Set 2"></iframe>
            </div>
            <div class="carousel-item">
              <iframe width="100%" height="120" src="https://player-widget.mixcloud.com/widget/iframe/?hide_cover=1&feed=%2Fricardo-almeida28%2Fnadar%2F" frameborder="0" title="DJ Set 3"></iframe>
            </div>
          </div>
        </div>
        <button class="carousel-arrow next" aria-label="Next set">→</button>
      </div>
    </div>

    <!-- Playlists Section -->
    <div class="project-container">
      <h3 class="subsection-title">My Playlists</h3>
      <div class="playlists-gallery">
        <div class="playlist-item">
          <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/2EOgO6HyRqoFVyoS5DeGHg?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy" title="Playlist 1"></iframe>
        </div>
        <div class="playlist-item">
          <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/0yWK4qg5GYnriJbJVVq159?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy" title="Playlist 2"></iframe>
        </div>
        <div class="playlist-item">
          <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/3YAOE2K50HfP25uBowFRJJ?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy" title="Playlist 3"></iframe>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .side-projects-section {
    padding: 4rem 0;
    background: var(--color-gray-900);
  }

  .section-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .section-title {
    font-size: var(--font-size-2xl);
    color: var(--color-cosmic-latte);
    margin-bottom: 2rem;
    font-family: var(--font-family-title);
  }

  .project-container {
    margin-bottom: 4rem;
  }

  .project-container:last-child {
    margin-bottom: 0;
  }

  .subsection-title {
    font-size: var(--font-size-xl);
    color: var(--color-cosmic-latte);
    margin-bottom: 1rem;
    font-family: var(--font-family-title);
  }

  .section-description {
    margin-bottom: 2rem;
    line-height: var(--line-height-loose);
  }

  /* Sets Carousel Styles */
  .sets-carousel {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .carousel-container {
    flex: 1;
    overflow: hidden;
  }

  .carousel-track {
    display: flex;
    transition: transform 0.3s ease;
  }

  .carousel-item {
    flex: 0 0 100%;
    padding: 0 0.5rem;
  }

  .carousel-arrow {
    background: var(--color-cosmic-latte-10);
    border: 1px solid var(--color-cosmic-latte);
    color: var(--color-white);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .carousel-arrow:hover {
    background: var(--color-cosmic-latte-20);
    transform: scale(1.1);
  }

  /* Playlists Gallery Styles */
  .playlists-gallery {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding: 1rem 0;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }

  /* Custom Scrollbar for Playlists */
  .playlists-gallery::-webkit-scrollbar {
    height: 6px;
  }

  .playlists-gallery::-webkit-scrollbar-track {
    background: var(--color-cosmic-latte-10);
    border-radius: 3px;
  }

  .playlists-gallery::-webkit-scrollbar-thumb {
    background: var(--color-cosmic-latte);
    border-radius: 3px;
  }

  .playlists-gallery::-webkit-scrollbar-thumb:hover {
    background: var(--color-cosmic-latte-20);
  }

  /* Firefox scrollbar */
  .playlists-gallery {
    scrollbar-width: thin;
    scrollbar-color: var(--color-cosmic-latte) var(--color-cosmic-latte-10);
  }

  .playlist-item {
    flex: 0 0 50%;
    scroll-snap-align: start;
  }

  /* Responsive Styles */
  @media (max-width: 768px) {
    .playlist-item {
      flex: 0 0 100%;
    }

    .section-title {
      font-size: var(--font-size-xl);
    }

    .subsection-title {
      font-size: var(--font-size-lg);
    }
  }
</style>

<script>
  // Carousel functionality
  const track = document.querySelector('.carousel-track') as HTMLElement;
  const items = document.querySelectorAll('.carousel-item');
  const prevBtn = document.querySelector('.carousel-arrow.prev') as HTMLButtonElement;
  const nextBtn = document.querySelector('.carousel-arrow.next') as HTMLButtonElement;
  
  let currentIndex = 0;

  function updateCarousel() {
    if (track) {
      const percentage = currentIndex * -100;
      track.style.transform = `translateX(${percentage}%)`;
      
      // Update button states
      if (prevBtn) prevBtn.disabled = currentIndex === 0;
      if (nextBtn) nextBtn.disabled = currentIndex === items.length - 1;
    }
  }

  prevBtn?.addEventListener('click', () => {
    if (currentIndex > 0) {
      currentIndex--;
      updateCarousel();
    }
  });

  nextBtn?.addEventListener('click', () => {
    if (currentIndex < items.length - 1) {
      currentIndex++;
      updateCarousel();
    }
  });

  // Initialize carousel
  updateCarousel();
</script> 