---
/**
 * Main Layout Component
 * 
 * This layout sets up the basic structure for all pages on the site,
 * including global styles and meta tags.
 */
import { getLangFromUrl, useTranslations, getLocalizedUrl } from '../i18n/utils';
import { languages } from '../i18n/ui';

const { title, description, image, canonical, hideLangSelector = false, currentLanguage } = Astro.props;

// Get language and translations
const lang = currentLanguage || getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Default meta values
const defaultTitle = "Ricardo Almeida | Data & AI Manager | Cloud Solution Architect";
const defaultDescription = "Data & AI Manager at PwC Portugal specializing in AI solutions, Cloud Architecture, Microsoft Power Platform, and RAG implementations. Certified Azure and Power Platform solution architect.";
const defaultImage = "/images/profile-cover.jpg";
const siteUrl = "https://me.ricbits.cc";

// Use reCAPTCHA v3 site key
const recaptchaSiteKey = import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY || '6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI';
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- Primary Meta Tags -->
    <title>{title || defaultTitle}</title>
    <meta name="title" content={title || defaultTitle} />
    <meta name="description" content={description || defaultDescription} />
    <meta name="author" content="Ricardo Almeida" />
    <meta name="keywords" content="AI Solutions Architecture, RAG, LLM Integration, Microsoft Power Platform, Azure Cloud Architecture, Data & AI Manager, Cloud Solution Architect, Power BI, Data Science, Low-code Development" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonical || siteUrl} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonical || siteUrl} />
    <meta property="og:title" content={title || defaultTitle} />
    <meta property="og:description" content={description || defaultDescription} />
    <meta property="og:image" content={image || defaultImage} />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonical || siteUrl} />
    <meta property="twitter:title" content={title || defaultTitle} />
    <meta property="twitter:description" content={description || defaultDescription} />
    <meta property="twitter:image" content={image || defaultImage} />
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    
    <!-- RSS Feeds -->
    <link rel="alternate" type="application/rss+xml" title="Ricardo Almeida (English)" href="/en/rss.xml" />
    <link rel="alternate" type="application/rss+xml" title="Ricardo Almeida (Português)" href="/pt/rss.xml" />
    
    <!-- Google Fonts: Switch to serif for small text and sans serif for headers -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Slab:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- reCAPTCHA v3 script -->
    <script is:inline src={`https://www.google.com/recaptcha/api.js?render=${recaptchaSiteKey}`}></script>
    
    <!-- Structured Data for Professional Profile -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Ricardo Almeida",
        "url": "https://me.ricbits.cc",
        "jobTitle": "Manager, Data & AI | Cloud Solution Architect",
        "worksFor": {
          "@type": "Organization",
          "name": "PwC Portugal"
        },
        "description": "Data & AI lead with a passion for creating practical, AI-powered cloud-based products that blend low-code and pro-code approaches.",
        "skills": "AI Solutions Architecture, RAG, LLM Integration, Microsoft Power Platform, Azure Cloud Architecture",
        "image": "/images/profile-cover.jpg",
        "sameAs": [
          "https://www.linkedin.com/in/ricardodpa"
        ]
      }
    </script>
  </head>
  <body>
    <header>
      <div className="header-wrapper">
        {!hideLangSelector && (
          <div className="language-selector">
            {Object.entries(languages).map(([langCode, langName]) => (
              <a 
                href={getLocalizedUrl(Astro.url, langCode as ('en' | 'pt'))} 
                className={`language-btn ${langCode} ${langCode === lang ? 'active' : ''}`}
                aria-label={langCode === 'en' ? 'Switch to English' : 'Mudar para Português'}
              >
                {langCode.toUpperCase()}
              </a>
            ))}
          </div>
        )}
        
        <nav className="main-nav">
          <div className="container nav-container">
            <ul>
              <li><a href={`/${lang}/`} className={Astro.url.pathname === `/${lang}/` || Astro.url.pathname === `/${lang}` ? 'active' : ''}>{t('nav.home')}</a></li>
              <li><a href={`/${lang}/about`} className={Astro.url.pathname === `/${lang}/about` ? 'active' : ''}>{t('nav.about')}</a></li>
              <li><a href={`/${lang}/blog`} className={Astro.url.pathname.startsWith(`/${lang}/blog`) ? 'active' : ''}>{t('nav.blog')}</a></li>
              <li><a href={`/${lang}/podcast`} className={Astro.url.pathname === `/${lang}/podcast` ? 'active' : ''}>{t('nav.podcast')}</a></li>
              <li><a href={`/${lang}/music`} className={Astro.url.pathname === `/${lang}/music` ? 'active' : ''}>{t('nav.music')}</a></li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    
    <slot />
    
    <footer>
      <div className="container">
        <p className="footer-text">{t('footer.copyright')}</p>
      </div>
    </footer>
  </body>
</html>

<style is="global">
  /**
   * Global Styles
   * 
   * Sets up basic styling and colors for the entire site.
   * Uses CSS variables for easy theme modifications.
   */
  :root {
    /* Color palette */
    --color-dark-gray: #2c2c2c;
    --color-white: #ffffff;
    --color-cosmic-latte: #fff8e7;
    --color-cosmic-latte-10: rgba(255, 248, 231, 0.1);
    --color-cosmic-latte-20: rgba(255, 248, 231, 0.2);
    --color-gray-100: rgba(255, 255, 255, 0.1);
    --color-gray-200: rgba(255, 255, 255, 0.2);
    --color-gray-300: rgba(255, 255, 255, 0.3);
    --color-gray-600: rgba(255, 255, 255, 0.6);
    
    /* Typography - Swapped base and title/alt fonts */
    --font-family-base: 'Roboto', sans-serif; /* Changed to Roboto for body */
    --font-family-title: 'Roboto Slab', serif; /* Changed to Roboto Slab for titles */
    --font-family-alt: 'Roboto Slab', serif; /* Changed to Roboto Slab for alt */
    
    /* Font weights */
    --font-weight-light: 300;
    --font-weight-regular: 400;
    --font-weight-medium: 500;
    --font-weight-bold: 700;
    
    /* Font sizes */
    --font-size-base: clamp(1rem, 0.95rem + 0.25vw, 1.125rem);
    --font-size-sm: clamp(0.875rem, 0.825rem + 0.25vw, 1rem);
    --font-size-lg: clamp(1.125rem, 1.05rem + 0.375vw, 1.25rem);
    --font-size-xl: clamp(1.5rem, 1.25rem + 1.25vw, 1.75rem);
    --font-size-2xl: clamp(2rem, 1.75rem + 1.25vw, 2.25rem);
    --font-size-3xl: clamp(2.5rem, 2rem + 2.5vw, 3rem);
    
    /* Line heights */
    --line-height-tight: 1.2;
    --line-height-base: 1.5;
    --line-height-loose: 1.8;
    
    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 2rem;
    --spacing-xl: 3rem;
    
    /* Transitions */
    --transition-fast: 0.2s ease;
    --transition-base: 0.3s ease;
    --transition-slow: 0.5s ease;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  html {
    scroll-behavior: smooth;
  }
  
  body {
    font-family: var(--font-family-base);
    font-weight: var(--font-weight-regular);
    font-size: var(--font-size-base);
    line-height: var(--line-height-base);
    background-color: var(--color-dark-gray);
    color: var(--color-white);
    transition: background-color var(--transition-slow);
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-family-title);
    margin-bottom: var(--spacing-md);
    line-height: var(--line-height-tight);
    letter-spacing: -0.01em;
  }
  
  h1 {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
  }
  
  h2 {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-medium);
  }
  
  h3 {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-medium);
  }
  
  p {
    margin-bottom: var(--spacing-md);
  }
  
  a {
    color: var(--color-white);
    text-decoration: none;
    transition: all var(--transition-base);
    position: relative;
  }
  
  a:hover, a:focus {
    color: var(--color-cosmic-latte);
  }
  
  a:focus {
    outline: 2px solid var(--color-cosmic-latte-20);
    outline-offset: 2px;
  }
  
  a:focus:not(:focus-visible) {
    outline: none;
  }
  
  a:focus-visible {
    outline: 2px solid var(--color-cosmic-latte-20);
    outline-offset: 2px;
  }
  
  .highlight {
    color: var(--color-cosmic-latte);
  }
  
  .container {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    padding: 0 var(--spacing-md);
  }
  
  /* Header structure and wrapper */
  .header-wrapper {
    position: relative;
    width: 100%;
    border-bottom: 1px solid var(--color-gray-100);
  }
  
  /* Main navigation */
  .main-nav {
    padding: var(--spacing-md) 0;
    transition: border-color var(--transition-base);
  }
  
  .nav-container {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .main-nav ul {
    display: flex;
    list-style: none;
    gap: var(--spacing-lg);
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .main-nav a {
    font-family: var(--font-family-title); /* Ensure nav links use sans-serif */
    font-weight: var(--font-weight-medium);
    font-size: 0.9rem;
    letter-spacing: 0.02em;
    text-transform: capitalize;
    padding: var(--spacing-xs) 0;
    position: relative;
  }
  
  .main-nav a.active {
    color: var(--color-cosmic-latte);
  }
  
  .main-nav a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--color-cosmic-latte);
    transition: width var(--transition-base);
  }
  
  .main-nav a:hover::after,
  .main-nav a:focus::after,
  .main-nav a.active::after {
    width: 100%;
  }
  
  /* Language Selector in Header */
  .language-selector {
    display: flex;
    gap: 0.4rem;
    position: absolute;
    top: 0.8rem;
    right: 1rem;
    z-index: 10;
  }
  
  .language-btn {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    background: transparent;
    border: 1px solid var(--color-gray-200);
    color: var(--color-white);
    padding: 0.25rem 0.6rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: var(--font-weight-medium);
    transition: all var(--transition-base);
    height: 28px !important;
    min-width: 28px;
    text-align: center;
    text-decoration: none;
  }
  
  .language-btn:hover {
    background-color: var(--color-cosmic-latte-10);
    border-color: var(--color-cosmic-latte);
  }
  
  .language-btn.active {
    background-color: var(--color-cosmic-latte-10);
    border-color: var(--color-cosmic-latte);
    color: var(--color-cosmic-latte);
  }
  
  /* Footer */
  footer {
    margin-top: var(--spacing-xl);
    padding: var(--spacing-lg) 0;
    border-top: 1px solid var(--color-gray-100);
    text-align: center;
    transition: border-color var(--transition-base);
  }
  
  .footer-text {
    font-size: var(--font-size-sm);
    color: var(--color-gray-600);
    margin-bottom: var(--spacing-md);
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .container {
      padding: 0 var(--spacing-md);
    }
    
    .main-nav ul {
      gap: var(--spacing-md);
    }
  }
  
  @media (max-width: 480px) {
    :root {
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
    }
    
    .main-nav {
      padding: var(--spacing-sm) 0;
      overflow-x: auto;
      white-space: nowrap;
    }
    
    .main-nav .container {
      max-width: none;
      padding: 0 var(--spacing-sm);
      justify-content: flex-start;
    }
    
    .main-nav ul {
      flex-wrap: nowrap;
      justify-content: flex-start;
      gap: var(--spacing-md);
      padding-bottom: 0;
    }
    
    .language-selector {
      position: absolute;
      top: 0.6rem;
      right: 0.6rem;
      z-index: 100;
    }
  }

  /* Add a focus indicator for interactive elements without natural borders */
  [tabindex]:not(button):not(input):not(textarea):not(select):not(a):focus-visible {
    position: relative;
  }

  [tabindex]:not(button):not(input):not(textarea):not(select):not(a):focus-visible::after {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    border-radius: 4px;
    border: 2px solid var(--color-cosmic-latte);
    pointer-events: none;
  }

  /* High contrast mode focus indicators */
  @media (forced-colors: active) {
    .profile-link:focus-visible, /* Keep profile selectors for now if they exist */
    .language-btn:focus-visible,
    .skill-item:focus-visible,
    .credential-link:focus-visible,
    button:focus-visible,
    a:focus-visible,
    input:focus-visible,
    textarea:focus-visible,
    select:focus-visible,
    [role="button"]:focus-visible,
    [tabindex]:focus-visible {
      outline: 3px solid CanvasText;
      outline-offset: 3px;
    }
  }

  /* =============================================
     END MOVED FOCUS STYLES
     ============================================= */
</style>